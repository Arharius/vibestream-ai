<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>VibeStream PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background: #0f172a; color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .spinner { border: 3px solid rgba(255, 255, 255, 0.1); border-top: 3px solid #ec4899; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen py-12 px-4">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-16">
            <h1 class="text-6xl font-black italic bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-violet-500 mb-4">VIBESTREAM PRO</h1>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
            <div class="bg-slate-900/50 p-8 rounded-3xl border border-slate-800">
                <h3 class="text-pink-500 font-bold mb-4 uppercase text-xs">YouTube URL</h3>
                <input id="url" type="text" placeholder="https://..." class="w-full bg-slate-950 border border-slate-700 rounded-2xl p-4 mb-4 outline-none focus:border-pink-500">
                <button onclick="handleAction('url')" class="w-full bg-pink-600 hover:bg-pink-700 font-bold py-4 rounded-2xl transition-all">–ê–ù–ê–õ–ò–ó</button>
            </div>
            <div class="bg-slate-900/50 p-8 rounded-3xl border border-slate-800">
                <h3 class="text-emerald-500 font-bold mb-4 uppercase text-xs">–§–∞–π–ª –ê—É–¥–∏–æ</h3>
                <input id="file" type="file" class="w-full text-sm text-slate-400 mb-4">
                <button onclick="handleAction('file')" class="w-full bg-emerald-600 hover:bg-emerald-700 font-bold py-4 rounded-2xl transition-all">–û–ë–†–ê–ë–û–¢–ê–¢–¨</button>
            </div>
        </div>

        <div id="status-box" class="hidden mb-12 p-8 bg-slate-900 border-l-8 border-pink-500 rounded-r-3xl flex items-center gap-6">
            <div class="spinner"></div>
            <div id="status-text" class="text-xl font-bold italic text-pink-100">–ó–∞–ø—É—Å–∫...</div>
        </div>

        <div id="result" class="hidden bg-slate-900/50 p-10 rounded-3xl prose prose-invert max-w-none border border-slate-800 shadow-2xl"></div>
    </div>

    <script>
        let poll;
        async function handleAction(type) {
            document.getElementById('result').classList.add('hidden');
            const box = document.getElementById('status-box');
            const txt = document.getElementById('status-text');
            box.classList.remove('hidden');

            try {
                let r;
                if(type === 'url') {
                    const url = document.getElementById('url').value;
                    if(!url) return;
                    txt.innerText = "üîç –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º...";
                    r = await fetch(`/process-live?url=${encodeURIComponent(url)}`);
                } else {
                    const file = document.getElementById('file').files[0];
                    if(!file) return;
                    txt.innerText = "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...";
                    const fd = new FormData(); fd.append('file', file);
                    r = await fetch('/upload-audio', { method: 'POST', body: fd });
                }
                const d = await r.json();
                if(d.task_id) startPolling(d.task_id);
            } catch(e) {
                txt.innerText = "‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.";
            }
        }

        function startPolling(id) {
            if(poll) clearInterval(poll);
            poll = setInterval(async () => {
                try {
                    const r = await fetch(`/check-status?task_id=${id}`);
                    const d = await r.json();
                    if (typeof d.data === 'object' && d.data.result) {
                        clearInterval(poll);
                        document.getElementById('result').innerHTML = marked.parse(d.data.result);
                        document.getElementById('result').classList.remove('hidden');
                        document.getElementById('status-box').classList.add('hidden');
                    } else {
                        document.getElementById('status-text').innerText = d.data;
                    }
                } catch(e) { console.log("–û–ø—Ä–æ—Å..."); }
            }, 3000);
        }
    </script>
</body>
</html>